{% extends 'base.html' %}
{% load static %}

{% block content %}
<div class="min-h-screen bg-background cosmic-bg">
    <!-- Анимированный фон -->
    <div class="fixed inset-0 overflow-hidden pointer-events-none">
        <div class="stars"></div>
        <div class="shooting-stars"></div>
        <div class="nebula"></div>
    </div>

    <!-- Обложка профиля с параллакс эффектом -->
    <div class="relative h-96 w-full overflow-hidden profile-cover">
        {% if profile.cover %}
            <img src="{{ profile.cover.url }}" 
                 alt="Cover" 
                 class="w-full h-full object-cover transform hover:scale-105 transition-all duration-700 parallax-cover"
                 style="transform-origin: center;">
        {% else %}
            <div class="w-full h-full animated-gradient-bg"></div>
        {% endif %}
        
        {% if request.user == viewed_user %}
        <div class="absolute bottom-4 right-4 flex space-x-2 z-10">
            <label for="cover-upload" 
                   class="px-6 py-3 bg-black/50 text-white rounded-xl cursor-pointer hover:bg-black/70 transition-all hover:scale-105 backdrop-blur-sm border border-white/10 flex items-center space-x-2">
                <i class="fas fa-camera"></i>
                <span>Изменить обложку</span>
            </label>
        </div>
        <input type="file" id="cover-upload" name="cover" class="hidden" accept="image/*">
        {% endif %}
        
        <!-- Улучшенный градиентный оверлей -->
        <div class="absolute inset-0 bg-gradient-to-t from-background via-background/50 to-transparent"></div>
        
        <!-- Анимированные частиы -->
        <div class="particles"></div>
    </div>

    <!-- Основная информация -->
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 -mt-20 relative z-10">
        <!-- Карточка профиля с неоновым свечением -->
        <div class="neon-card glass-effect rounded-2xl p-8 border border-white/10 hover:border-purple-500/30 transition-all duration-500">
            <!-- Профиль -->
            <div class="flex flex-col md:flex-row items-center gap-8">
                <!-- Аватар с анимированной рамкой -->
                <div class="relative group">
                    {% if profile.avatar %}
                        <div class="w-40 h-40 rounded-full overflow-hidden">
                            <img src="{{ profile.avatar.url }}" 
                                 alt="Avatar" 
                                 class="w-full h-full object-cover transform hover:scale-105 transition-all duration-500">
                        </div>
                    {% else %}
                        <div class="w-40 h-40 rounded-full bg-purple-500/20 flex items-center justify-center">
                            <i class="fas fa-user text-5xl text-purple-400"></i>
                        </div>
                    {% endif %}
                    
                    {% if request.user == viewed_user %}
                    <label for="avatar-upload" class="absolute bottom-2 right-2 w-10 h-10 bg-purple-500 rounded-full flex items-center justify-center cursor-pointer hover:bg-purple-600 transition-all hover:scale-110">
                        <i class="fas fa-camera text-white"></i>
                    </label>
                    <input type="file" id="avatar-upload" class="hidden" accept="image/*">
                    {% endif %}
                </div>

                <!-- Информация о пользователе -->
                <div class="flex-1 text-center md:text-left">
                    <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4">
                        <div>
                            <div class="flex flex-col md:flex-row md:items-center gap-2 md:gap-4">
                                <h1 class="text-4xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-white via-purple-200 to-white animate-gradient-x mb-2">
                                    {{ viewed_user.username }}
                                </h1>
                                <!-- Роль пользователя -->
                                {% with role=viewed_user.profile.get_role_display_with_icon %}
                                <span class="inline-flex items-center px-3 py-1 rounded-full bg-purple-500/20 text-purple-400 text-sm">
                                    <i class="fas {{ role.icon }} mr-2"></i>
                                    {{ role.name }}
                                </span>
                                {% endwith %}
                            </div>
                            {% if profile.occupation %}
                                <p class="text-gray-400 text-glow flex items-center">
                                    <i class="fas fa-briefcase mr-2 text-purple-400"></i>
                                    {{ profile.occupation }}
                                </p>
                            {% endif %}
                        </div>
                        
                        {% if request.user == viewed_user %}
                        <a href="{% url 'blog:edit_profile' %}" 
                           class="inline-flex items-center px-6 py-3 bg-purple-500/20 text-purple-400 rounded-xl hover:bg-purple-500/30 transition-all hover:scale-105 edit-button-glow">
                            <i class="fas fa-edit mr-2"></i>
                            Редактировать профиль
                        </a>
                        {% endif %}
                    </div>

                    <!-- Дополнительная информация -->
                    <div class="flex flex-wrap gap-4 mt-4">
                        {% if profile.location %}
                        <div class="flex items-center text-gray-400">
                            <i class="fas fa-map-marker-alt text-purple-400 mr-2"></i>
                            {{ profile.location }}
                        </div>
                        {% endif %}
                        
                        {% if profile.website %}
                        <a href="{{ profile.website }}" target="_blank" 
                           class="flex items-center text-gray-400 hover:text-purple-400 transition-colors">
                            <i class="fas fa-globe text-purple-400 mr-2"></i>
                            {{ profile.website }}
                        </a>
                        {% endif %}
                        
                        <div class="flex items-center text-gray-400">
                            <i class="fas fa-calendar text-purple-400 mr-2"></i>
                            На сайте с {{ viewed_user.date_joined|date:"d.m.Y" }}
                        </div>
                    </div>

                    {% if profile.bio %}
                    <div class="mt-4 p-4 rounded-xl bg-purple-500/5 border border-purple-500/10">
                        <p class="text-gray-300 bio-text">{{ profile.bio }}</p>
                    </div>
                    {% endif %}

                    <!-- Улучшенная статистика с анимацией -->
                    <div class="grid grid-cols-4 gap-4 mt-6">
                        <div class="stat-card p-4 rounded-xl bg-purple-500/10 hover:bg-purple-500/20 transition-all transform hover:scale-105 hover:rotate-1">
                            <div class="text-2xl font-bold text-white stat-number">{{ total_posts }}</div>
                            <div class="text-sm text-gray-400">Постов</div>
                        </div>
                        <div class="stat-card p-4 rounded-xl bg-pink-500/10 hover:bg-pink-500/20 transition-all transform hover:scale-105 hover:-rotate-1">
                            <div class="text-2xl font-bold text-white stat-number">{{ total_views }}</div>
                            <div class="text-sm text-gray-400">Просмотров</div>
                        </div>
                        <div class="stat-card p-4 rounded-xl bg-blue-500/10 hover:bg-blue-500/20 transition-all transform hover:scale-105 hover:rotate-1">
                            <div class="text-2xl font-bold text-white stat-number">{{ streak_days }}</div>
                            <div class="text-sm text-gray-400">Дней подряд</div>
                        </div>
                        <div class="stat-card p-4 rounded-xl bg-green-500/10 hover:bg-green-500/20 transition-all transform hover:scale-105 hover:-rotate-1">
                            <div class="text-2xl font-bold text-white stat-number">{{ achievements_count }}</div>
                            <div class="text-sm text-gray-400">Достижений</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Достижения -->
            <div class="mt-8 pt-8 border-t border-purple-500/10">
                <h2 class="text-2xl font-bold text-white mb-6 flex items-center">
                    <i class="fas fa-trophy text-yellow-400 mr-3"></i>
                    Достижения
                </h2>
                <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                    <!-- Первый пост -->
                    <div class="achievement-card p-4 rounded-xl bg-gradient-to-br from-purple-500/10 to-pink-500/10 backdrop-blur-sm 
                                {% if total_posts > 0 %}opacity-100{% else %}opacity-50{% endif %}">
                        <i class="fas fa-star text-yellow-400 text-2xl mb-2"></i>
                        <h3 class="font-semibold text-white">Первый пост</h3>
                        <p class="text-sm text-gray-400">Опубликован первый пост</p>
                    </div>
                    
                    <!-- 10 постов -->
                    <div class="achievement-card p-4 rounded-xl bg-gradient-to-br from-blue-500/10 to-purple-500/10 backdrop-blur-sm
                                {% if total_posts >= 10 %}opacity-100{% else %}opacity-50{% endif %}">
                        <i class="fas fa-award text-blue-400 text-2xl mb-2"></i>
                        <h3 class="font-semibold text-white">Активный автор</h3>
                        <p class="text-sm text-gray-400">Опубликовано 10 постов</p>
                    </div>
                    
                    <!-- 100 просмотров -->
                    <div class="achievement-card p-4 rounded-xl bg-gradient-to-br from-green-500/10 to-blue-500/10 backdrop-blur-sm
                                {% if total_views >= 100 %}opacity-100{% else %}opacity-50{% endif %}">
                        <i class="fas fa-eye text-green-400 text-2xl mb-2"></i>
                        <h3 class="font-semibold text-white">Популярность</h3>
                        <p class="text-sm text-gray-400">100 просмотров постов</p>
                    </div>
                    
                    <!-- Серия публикаций -->
                    <div class="achievement-card p-4 rounded-xl bg-gradient-to-br from-pink-500/10 to-orange-500/10 backdrop-blur-sm
                                {% if streak_days >= 3 %}opacity-100{% else %}opacity-50{% endif %}">
                        <i class="fas fa-fire text-orange-400 text-2xl mb-2"></i>
                        <h3 class="font-semibold text-white">На волне</h3>
                        <p class="text-sm text-gray-400">3 дня публикаций подряд</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Поседние посты -->
        <div class="mt-8">
            <h2 class="text-2xl font-bold text-white mb-6 flex items-center">
                <i class="fas fa-newspaper text-purple-400 mr-3"></i>
                Последние убликации
            </h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                {% for post in posts %}
                <a href="{% url 'blog:post_detail' slug=post.slug %}" class="block">
                    <article class="glass-effect rounded-xl overflow-hidden hover:scale-[1.02] transition-all duration-300 group">
                        {% if post.thumbnail %}
                        <div class="aspect-video relative overflow-hidden">
                            <img src="{{ post.thumbnail.url }}" 
                                 alt="{{ post.title }}" 
                                 class="w-full h-full object-cover transform group-hover:scale-105 transition-all duration-500">
                            <div class="absolute inset-0 bg-gradient-to-t from-black/50 to-transparent opacity-0 group-hover:opacity-100 transition-all"></div>
                        </div>
                        {% endif %}
                        
                        <div class="p-6">
                            <h3 class="text-xl font-bold text-white mb-2 group-hover:text-purple-400 transition-colors">
                                {{ post.title }}
                            </h3>
                            <p class="text-gray-400 mb-4">{{ post.content|striptags|truncatewords:30 }}</p>
                            <div class="flex items-center justify-between text-sm text-gray-400">
                                <div class="flex items-center space-x-4">
                                    <span class="flex items-center">
                                        <i class="fas fa-eye mr-1 icon-pulse"></i>
                                        {{ post.views_count }}
                                    </span>
                                    <span class="flex items-center">
                                        <i class="fas fa-comment mr-1 icon-pulse"></i>
                                        {{ post.comments.count }}
                                    </span>
                                </div>
                                <span>{{ post.created_at|date:"d.m.Y" }}</span>
                            </div>
                            
                            <!-- Категория и теги -->
                            <div class="flex items-center justify-between mt-4">
                                {% if post.category %}
                                <span class="text-sm px-3 py-1 rounded-full bg-purple-500/10 text-purple-400">
                                    <i class="{{ post.category.icon }} mr-1"></i>
                                    {{ post.category.name }}
                                </span>
                                {% endif %}
                                <div class="flex flex-wrap gap-2">
                                    {% for tag in post.tags.all|slice:":2" %}
                                    <span class="text-sm px-2 py-1 rounded-full bg-purple-500/5 text-purple-400">
                                        #{{ tag.name }}
                                    </span>
                                    {% endfor %}
                                </div>
                            </div>
                        </div>
                    </article>
                </a>
                {% empty %}
                <div class="col-span-2 text-center py-12">
                    <div class="w-20 h-20 mx-auto mb-4 rounded-full bg-purple-500/20 flex items-center justify-center empty-state-icon">
                        <i class="fas fa-file-alt text-3xl text-purple-400"></i>
                    </div>
                    <h3 class="text-xl font-bold text-white mb-2">Нет публикаций</h3>
                    <p class="text-gray-400">Здесь появятся опубликованные посты</p>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>
</div>

<style>
/* Более темный фон */
.cosmic-bg {
    background: 
        linear-gradient(to bottom,
            rgba(13, 10, 25, 0.95),
            rgba(19, 17, 28, 0.95)
        ),
        radial-gradient(circle at 20% 20%, rgba(139, 92, 246, 0.07) 0%, transparent 40%),
        radial-gradient(circle at 80% 80%, rgba(236, 72, 153, 0.07) 0%, transparent 40%),
        radial-gradient(circle at 50% 50%, rgba(99, 102, 241, 0.05) 0%, transparent 60%);
}

/* Улучшенные карточки постов */
.post-card {
    background: rgba(20, 17, 34, 0.7);
    backdrop-filter: blur(12px);
    border: 1px solid rgba(139, 92, 246, 0.1);
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    position: relative;
    overflow: hidden;
}

.post-card:hover {
    transform: translateY(-5px);
    border-color: rgba(139, 92, 246, 0.3);
    box-shadow: 
        0 10px 30px rgba(0, 0, 0, 0.3),
        0 0 20px rgba(139, 92, 246, 0.1);
}

.post-card::after {
    content: '';
    position: absolute;
    inset: 0;
    background: linear-gradient(
        45deg,
        rgba(139, 92, 246, 0.1),
        rgba(236, 72, 153, 0.1)
    );
    opacity: 0;
    transition: opacity 0.3s ease;
}

.post-card:hover::after {
    opacity: 1;
}

/* Анимированная ссылка на пост */
.post-link {
    position: relative;
    display: inline-block;
    transition: all 0.3s ease;
}

.post-link::after {
    content: '';
    position: absolute;
    left: 0;
    bottom: -2px;
    width: 100%;
    height: 2px;
    background: linear-gradient(
        to right,
        rgba(139, 92, 246, 0.5),
        rgba(236, 72, 153, 0.5)
    );
    transform: scaleX(0);
    transform-origin: right;
    transition: transform 0.3s ease;
}

.post-link:hover::after {
    transform: scaleX(1);
    transform-origin: left;
}

/* Анимированный фон */
.animated-gradient-bg {
    background: linear-gradient(45deg, 
        rgba(139, 92, 246, 0.1),
        rgba(236, 72, 153, 0.1),
        rgba(59, 130, 246, 0.1));
    background-size: 400% 400%;
    animation: gradientBG 15s ease infinite;
}

@keyframes gradientBG {
    0% { background-position: 0% 50%; }
    50% { background-position: 100% 50%; }
    100% { background-position: 0% 50%; }
}

/* Неоновое свечение для карточек */
.neon-card {
    box-shadow: 
        0 0 10px rgba(139, 92, 246, 0.1),
        0 0 20px rgba(139, 92, 246, 0.05),
        0 0 30px rgba(139, 92, 246, 0.025);
    transition: all 0.3s ease;
}

.neon-card:hover {
    box-shadow: 
        0 0 15px rgba(139, 92, 246, 0.2),
        0 0 30px rgba(139, 92, 246, 0.1),
        0 0 45px rgba(139, 92, 246, 0.05);
}

/* Анимация для статистики */
.stat-card {
    position: relative;
    overflow: hidden;
}

.stat-card::after {
    content: '';
    position: absolute;
    top: -50%;
    left: -50%;
    width: 200%;
    height: 200%;
    background: radial-gradient(
        circle at center,
        rgba(139, 92, 246, 0.1) 0%,
        transparent 70%
    );
    animation: rotateStat 10s linear infinite;
}

@keyframes rotateStat {
    from { transform: rotate(0deg); }
    to { transform: rotate(360deg); }
}

/* Пульсация иконок */
.icon-pulse {
    animation: iconPulse 2s ease-in-out infinite;
}

@keyframes iconPulse {
    0%, 100% { transform: scale(1); }
    50% { transform: scale(1.2); }
}

/* Анимированная рамка аватара */
.avatar-glow {
    position: relative;
    box-shadow: 
        0 0 20px rgba(139, 92, 246, 0.2),
        0 0 40px rgba(139, 92, 246, 0.1),
        inset 0 0 10px rgba(139, 92, 246, 0.1);
}

.avatar-container {
    position: relative;
}

.avatar-container::before {
    content: '';
    position: absolute;
    inset: -3px;
    background: linear-gradient(45deg,
        rgba(139, 92, 246, 0.5),
        rgba(236, 72, 153, 0.5)
    );
    border-radius: 50%;
    z-index: -1;
    animation: borderGlow 3s ease-in-out infinite;
}

@keyframes borderGlow {
    0%, 100% { opacity: 0.5; }
    50% { opacity: 1; }
}

/* Аимация для пустого состояния */
.empty-state-icon {
    animation: float 6s ease-in-out infinite;
}

@keyframes float {
    0%, 100% { transform: translateY(0); }
    50% { transform: translateY(-20px); }
}

/* Эффект параллакса для обложки */
.parallax-cover {
    transform: translateZ(0);
    transition: transform 0.3s ease-out;
}

.profile-cover:hover .parallax-cover {
    transform: translateZ(50px) scale(1.05);
}

/* Анимированные частицы */
.particles {
    position: absolute;
    inset: 0;
    pointer-events: none;
}

.particle {
    position: absolute;
    width: 3px;
    height: 3px;
    background: rgba(255, 255, 255, 0.5);
    border-radius: 50%;
    animation: particleFloat 15s infinite linear;
}

@keyframes particleFloat {
    0% {
        transform: translateY(0) rotate(0deg);
        opacity: 0;
    }
    50% {
        opacity: 0.8;
    }
    100% {
        transform: translateY(-100vh) rotate(360deg);
        opacity: 0;
    }
}

/* Добавляем частицы через JavaScript */
<script>
document.addEventListener('DOMContentLoaded', function() {
    const particlesContainer = document.querySelector('.particles');
    const particleCount = 50;

    for (let i = 0; i < particleCount; i++) {
        const particle = document.createElement('div');
        particle.className = 'particle';
        particle.style.left = `${Math.random() * 100}%`;
        particle.style.top = `${Math.random() * 100}%`;
        particle.style.animationDelay = `${Math.random() * 15}s`;
        particlesContainer.appendChild(particle);
    }
});
</script>

/* Анимированные звезды */
.stars {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;
    background: radial-gradient(circle at center, rgba(31, 41, 55, 0), rgba(31, 41, 55, 0.5));
}

.stars::after {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='3' height='3'%3E%3Ccircle cx='1.5' cy='1.5' r='1' fill='white' opacity='0.5'/%3E%3C/svg%3E");
    animation: twinkle 5s ease-in-out infinite alternate;
}

@keyframes twinkle {
    0%, 100% { opacity: 0.3; }
    50% { opacity: 0.8; }
}

/* Падающие звезды */
.shooting-stars {
    position: fixed;
    width: 100%;
    height: 100%;
    transform: rotate(-45deg);
}

.shooting-star {
    position: absolute;
    left: 50%;
    top: 50%;
    width: 4px;
    height: 4px;
    background: linear-gradient(90deg, rgba(255, 255, 255, 1), transparent);
    border-radius: 50%;
    animation: shoot 3s ease-out infinite;
}

@keyframes shoot {
    0% {
        transform: translate(0, 0);
        opacity: 1;
    }
    100% {
        transform: translate(-100px, 100px);
        opacity: 0;
    }
}

/* Туманность */
.nebula {
    position: fixed;
    width: 100%;
    height: 100%;
    background: 
        radial-gradient(circle at 20% 20%, rgba(139, 92, 246, 0.1), transparent 40%),
        radial-gradient(circle at 80% 80%, rgba(236, 72, 153, 0.1), transparent 40%);
    filter: blur(50px);
    animation: nebulaPulse 10s ease-in-out infinite;
}

@keyframes nebulaPulse {
    0%, 100% { opacity: 0.5; }
    50% { opacity: 0.8; }
}

/* Улучшенные карточки */
.stat-card {
    position: relative;
    overflow: hidden;
    transition: all 0.3s ease;
}

.stat-card::before {
    content: '';
    position: absolute;
    top: -50%;
    left: -50%;
    width: 200%;
    height: 200%;
    background: radial-gradient(
        circle at center,
        rgba(139, 92, 246, 0.2) 0%,
        transparent 70%
    );
    animation: rotate 10s linear infinite;
}

@keyframes rotate {
    from { transform: rotate(0deg); }
    to { transform: rotate(360deg); }
}

/* Временная шкала */
.timeline {
    position: relative;
    padding-left: 2rem;
}

.timeline::before {
    content: '';
    position: absolute;
    left: 0;
    top: 0;
    width: 2px;
    height: 100%;
    background: linear-gradient(to bottom, 
        rgba(139, 92, 246, 0.5),
        rgba(236, 72, 153, 0.5)
    );
}

.timeline-item {
    position: relative;
    padding-bottom: 2rem;
}

.timeline-item::before {
    content: '';
    position: absolute;
    left: -2rem;
    top: 0;
    width: 1rem;
    height: 1rem;
    border-radius: 50%;
    background: rgba(139, 92, 246, 0.5);
    border: 2px solid #1a1625;
    transition: all 0.3s ease;
}

.timeline-item:hover::before {
    transform: scale(1.2);
    box-shadow: 0 0 15px rgba(139, 92, 246, 0.5);
}

/* Улучшенные достижения */
.achievement-card {
    position: relative;
    overflow: hidden;
}

.achievement-card::after {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(
        90deg,
        transparent,
        rgba(255, 255, 255, 0.1),
        transparent
    );
    animation: shine 3s infinite;
}

@keyframes shine {
    0% { left: -100%; }
    20% { left: 100%; }
    100% { left: 100%; }
}

/* Анимированная рмка для аватара */
.avatar-container {
    position: relative;
}

.avatar-container::before {
    content: '';
    position: absolute;
    inset: -3px;
    background: linear-gradient(45deg, 
        rgba(139, 92, 246, 0.5),
        rgba(236, 72, 153, 0.5),
        rgba(59, 130, 246, 0.5));
    border-radius: inherit;
    z-index: -1;
    animation: borderGlow 3s ease-in-out infinite;
}

@keyframes borderGlow {
    0%, 100% { opacity: 0.5; }
    50% { opacity: 1; }
}

/* Галерея постов */
.post-gallery {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
    gap: 1.5rem;
}

.post-card {
    position: relative;
    overflow: hidden;
    transition: all 0.3s ease;
}

.post-card:hover {
    transform: translateY(-5px);
}

.post-card::after {
    content: '';
    position: absolute;
    inset: 0;
    border-radius: inherit;
    padding: 2px;
    background: linear-gradient(45deg, 
        rgba(139, 92, 246, 0.5), 
        rgba(236, 72, 153, 0.5)
    );
    -webkit-mask: 
        linear-gradient(#fff 0 0) content-box, 
        linear-gradient(#fff 0 0);
    mask: 
        linear-gradient(#fff 0 0) content-box, 
        linear-gradient(#fff 0 0);
    -webkit-mask-composite: xor;
    mask-composite: exclude;
    opacity: 0;
    transition: opacity 0.3s ease;
}

.post-card:hover::after {
    opacity: 1;
}

/* Анимация для статистики */
.stat-number {
    display: inline-block;
    animation: countUp 2s ease-out forwards;
    opacity: 0;
}

@keyframes countUp {
    from {
        opacity: 0;
        transform: translateY(20px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

/* Добавляем эффект свечения для активных элементов */
.glow-effect {
    position: relative;
}

.glow-effect::after {
    content: '';
    position: absolute;
    inset: 0;
    border-radius: inherit;
    padding: 2px;
    background: linear-gradient(45deg, 
        rgba(139, 92, 246, 0.5), 
        rgba(236, 72, 153, 0.5)
    );
    -webkit-mask: 
        linear-gradient(#fff 0 0) content-box, 
        linear-gradient(#fff 0 0);
    mask: 
        linear-gradient(#fff 0 0) content-box, 
        linear-gradient(#fff 0 0);
    -webkit-mask-composite: xor;
    mask-composite: exclude;
    opacity: 0;
    transition: opacity 0.3s ease;
}

.glow-effect:hover::after {
    opacity: 1;
}

/* Анимированный космический фон */
.cosmic-bg {
    position: relative;
    background: 
        radial-gradient(circle at 20% 20%, rgba(139, 92, 246, 0.15) 0%, transparent 40%),
        radial-gradient(circle at 80% 80%, rgba(236, 72, 153, 0.15) 0%, transparent 40%),
        radial-gradient(circle at 50% 50%, rgba(99, 102, 241, 0.1) 0%, transparent 60%);
}

.cosmic-bg::before {
    content: '';
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: 
        radial-gradient(2px 2px at 20px 30px, #eee, rgba(0,0,0,0)),
        radial-gradient(2px 2px at 40px 70px, #fff, rgba(0,0,0,0)),
        radial-gradient(2px 2px at 50px 160px, #ddd, rgba(0,0,0,0)),
        radial-gradient(2px 2px at 90px 40px, #fff, rgba(0,0,0,0)),
        radial-gradient(2px 2px at 130px 80px, #fff, rgba(0,0,0,0));
    background-repeat: repeat;
    background-size: 200px 200px;
    animation: stars 4s linear infinite;
    opacity: 0.3;
    z-index: 0;
}

@keyframes stars {
    0% { transform: translateY(0); }
    100% { transform: translateY(-100px); }
}

/* Улучшенная обложка профиля */
.profile-cover {
    position: relative;
    overflow: hidden;
    border-radius: 0 0 2rem 2rem;
    box-shadow: 
        0 10px 30px rgba(0, 0, 0, 0.3),
        0 0 0 1px rgba(255, 255, 255, 0.1);
}

.profile-cover::before {
    content: '';
    position: absolute;
    inset: 0;
    background: linear-gradient(to bottom,
        transparent 0%,
        rgba(26, 22, 37, 0.7) 50%,
        rgba(26, 22, 37, 1) 100%
    );
    z-index: 1;
}

.profile-cover::after {
    content: '';
    position: absolute;
    inset: 0;
    background: linear-gradient(45deg,
        rgba(139, 92, 246, 0.2),
        rgba(236, 72, 153, 0.2)
    );
    opacity: 0;
    transition: opacity 0.3s ease;
}

.profile-cover:hover::after {
    opacity: 1;
}

.profile-cover img {
    transform-origin: center;
    transition: transform 0.5s cubic-bezier(0.4, 0, 0.2, 1);
}

.profile-cover:hover img {
    transform: scale(1.05);
}

/* Кнопка изменения обложки */
.cover-upload-btn {
    position: relative;
    overflow: hidden;
    background: rgba(0, 0, 0, 0.5);
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255, 255, 255, 0.1);
    transition: all 0.3s ease;
}

.cover-upload-btn::before {
    content: '';
    position: absolute;
    top: -50%;
    left: -50%;
    width: 200%;
    height: 200%;
    background: radial-gradient(
        circle at center,
        rgba(139, 92, 246, 0.2) 0%,
        transparent 70%
    );
    transform: rotate(0deg);
    transition: transform 0.3s ease;
}

.cover-upload-btn:hover::before {
    transform: rotate(180deg);
}

/* Неоновое свечение для карточек */
.neon-card {
    position: relative;
    background: rgba(26, 22, 37, 0.8);
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255, 255, 255, 0.1);
    box-shadow: 
        0 0 20px rgba(139, 92, 246, 0.1),
        0 0 40px rgba(139, 92, 246, 0.05),
        inset 0 0 10px rgba(139, 92, 246, 0.05);
    transition: all 0.3s ease;
}

.neon-card:hover {
    border-color: rgba(139, 92, 246, 0.3);
    box-shadow: 
        0 0 30px rgba(139, 92, 246, 0.2),
        0 0 60px rgba(139, 92, 246, 0.1),
        inset 0 0 15px rgba(139, 92, 246, 0.1);
    transform: translateY(-5px);
}

/* Анимированный град��ент для фона */
.animated-gradient-bg {
    background: linear-gradient(
        45deg,
        rgba(139, 92, 246, 0.1),
        rgba(236, 72, 153, 0.1),
        rgba(99, 102, 241, 0.1)
    );
    background-size: 400% 400%;
    animation: gradientBG 15s ease infinite;
}

@keyframes gradientBG {
    0% { background-position: 0% 50%; }
    50% { background-position: 100% 50%; }
    100% { background-position: 0% 50%; }
}

/* Эффект свечения для статистики */
.stat-card {
    position: relative;
    overflow: hidden;
}

.stat-card::after {
    content: '';
    position: absolute;
    inset: 0;
    background: linear-gradient(45deg,
        rgba(139, 92, 246, 0.1),
        rgba(236, 72, 153, 0.1)
    );
    opacity: 0;
    transition: opacity 0.3s ease;
}

.stat-card:hover::after {
    opacity: 1;
}

/* Анимация для чисел в статистике */
.stat-number {
    background: linear-gradient(45deg, #fff, #a78bfa);
    -webkit-background-clip: text;
    background-clip: text;
    -webkit-text-fill-color: transparent;
    animation: numberPulse 2s ease-in-out infinite;
}

@keyframes numberPulse {
    0%, 100% { opacity: 0.8; }
    50% { opacity: 1; }
}

/* Улучшенный аватар */
.avatar-container {
    position: relative;
    z-index: 2;
}

.avatar-container::before {
    content: '';
    position: absolute;
    inset: -3px;
    background: linear-gradient(45deg,
        rgba(139, 92, 246, 0.5),
        rgba(236, 72, 153, 0.5)
    );
    border-radius: 50%;
    z-index: -1;
    animation: borderGlow 3s ease-in-out infinite;
}

@keyframes borderGlow {
    0%, 100% { opacity: 0.5; }
    50% { opacity: 1; }
}

/* Улучшенная обложка профиля */
.profile-cover {
    position: relative;
    height: 400px;
    overflow: hidden;
    border-radius: 0 0 3rem 3rem;
    box-shadow: 
        0 10px 30px rgba(0, 0, 0, 0.3),
        inset 0 0 50px rgba(139, 92, 246, 0.1);
}

.profile-cover img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transform-origin: center;
    transition: transform 0.8s cubic-bezier(0.4, 0, 0.2, 1);
    filter: brightness(0.9);
}

.profile-cover:hover img {
    transform: scale(1.05);
    filter: brightness(1);
}

/* Градиентный оверлей для обложки */
.profile-cover::before {
    content: '';
    position: absolute;
    inset: 0;
    background: linear-gradient(to bottom,
        transparent 0%,
        rgba(26, 22, 37, 0.7) 70%,
        rgba(26, 22, 37, 1) 100%
    ),
    linear-gradient(to right,
        rgba(139, 92, 246, 0.2) 0%,
        transparent 100%
    );
    z-index: 1;
    opacity: 0.8;
    transition: opacity 0.3s ease;
}

.profile-cover:hover::before {
    opacity: 1;
}

/* Анимированные частицы для обложки */
.profile-particle {
    position: absolute;
    width: 2px;
    height: 2px;
    background: rgba(255, 255, 255, 0.8);
    border-radius: 50%;
    pointer-events: none;
    z-index: 2;
    animation: floatParticle 10s infinite linear;
    box-shadow: 0 0 5px rgba(255, 255, 255, 0.5);
}

@keyframes floatParticle {
    0% { transform: translateY(0) rotate(0deg); opacity: 0; }
    20% { opacity: 0.8; }
    100% { transform: translateY(-100px) rotate(360deg); opacity: 0; }
}

/* Улучшенный аватар без квадратного эффекта */
.avatar-container {
    position: relative;
    width: 180px;
    height: 180px;
    margin-top: -90px;
    z-index: 2;
}

.avatar-container img,
.avatar-container .avatar-placeholder {
    width: 100%;
    height: 100%;
    border-radius: 50%;
    object-fit: cover;
    border: 4px solid rgba(139, 92, 246, 0.3);
    transition: all 0.3s ease;
    box-shadow: 
        0 0 20px rgba(139, 92, 246, 0.2),
        0 0 40px rgba(139, 92, 246, 0.1);
}

.avatar-container:hover img,
.avatar-container:hover .avatar-placeholder {
    transform: scale(1.05);
    border-color: rgba(139, 92, 246, 0.5);
    box-shadow: 
        0 0 30px rgba(139, 92, 246, 0.3),
        0 0 60px rgba(139, 92, 246, 0.2);
}

/* Кнопка изменения аватара */
.avatar-upload-btn {
    position: absolute;
    bottom: 5px;
    right: 5px;
    width: 40px;
    height: 40px;
    background: rgba(139, 92, 246, 0.9);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-center: center;
    cursor: pointer;
    transition: all 0.3s ease;
    border: 3px solid #1a1625;
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
}

.avatar-upload-btn:hover {
    transform: scale(1.1);
    background: rgba(139, 92, 246, 1);
}

/* Кнопка изменения обложки */
.cover-upload-btn {
    position: absolute;
    bottom: 1rem;
    right: 1rem;
    z-index: 2;
    background: rgba(0, 0, 0, 0.7);
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255, 255, 255, 0.1);
    padding: 0.75rem 1.5rem;
    border-radius: 1rem;
    color: white;
    display: flex;
    align-items: center;
    gap: 0.5rem;
    transition: all 0.3s ease;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
}

.cover-upload-btn:hover {
    background: rgba(0, 0, 0, 0.8);
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(0, 0, 0, 0.4);
}

/* Анимированные частицы для обложки */
@keyframes floatParticle {
    0% { transform: translateY(0) rotate(0deg); opacity: 0; }
    50% { opacity: 0.8; }
    100% { transform: translateY(-100px) rotate(360deg); opacity: 0; }
}

.profile-particle {
    position: absolute;
    width: 3px;
    height: 3px;
    background: rgba(255, 255, 255, 0.6);
    border-radius: 50%;
    pointer-events: none;
    animation: floatParticle 10s infinite linear;
}

/* Неоновое свечение для элементов */
.neon-glow {
    box-shadow:
        0 0 5px rgba(139, 92, 246, 0.2),
        0 0 10px rgba(139, 92, 246, 0.1),
        0 0 20px rgba(139, 92, 246, 0.05);
}

/* Анимация для свечения границы */
@keyframes borderGlow {
    0%, 100% { opacity: 0.5; }
    50% { opacity: 1; }
}

/* Добавляем частицы через JavaScript */
<script>
document.addEventListener('DOMContentLoaded', function() {
    const cover = document.querySelector('.profile-cover');
    const particleCount = 30;

    for (let i = 0; i < particleCount; i++) {
        const particle = document.createElement('div');
        particle.className = 'profile-particle';
        particle.style.left = `${Math.random() * 100}%`;
        particle.style.top = `${Math.random() * 100}%`;
        particle.style.animationDelay = `${Math.random() * 10}s`;
        cover.appendChild(particle);
    }
});
</script>

/* Улучшенный фон профиля */
.profile-bg {
    background: 
        radial-gradient(circle at 20% 20%, rgba(139, 92, 246, 0.15) 0%, transparent 40%),
        radial-gradient(circle at 80% 80%, rgba(236, 72, 153, 0.15) 0%, transparent 40%),
        radial-gradient(circle at 50% 50%, rgba(99, 102, 241, 0.1) 0%, transparent 60%);
}

/* Анимированное свечение для аватара */
.avatar-container img,
.avatar-container .fa-user {
    animation: avatarGlow 3s ease-in-out infinite;
}

@keyframes avatarGlow {
    0%, 100% { filter: brightness(1); }
    50% { filter: brightness(1.2); }
}

/* Улучшенные карточки статистики */
.stat-card {
    background: rgba(139, 92, 246, 0.1);
    backdrop-filter: blur(12px);
    border: 1px solid rgba(139, 92, 246, 0.2);
    transition: all 0.3s ease;
}

.stat-card:hover {
    transform: translateY(-2px);
    background: rgba(139, 92, 246, 0.15);
    border-color: rgba(139, 92, 246, 0.3);
    box-shadow: 0 8px 20px rgba(139, 92, 246, 0.2);
}

/* Анимированные иконки */
.icon-pulse {
    animation: iconPulse 2s ease-in-out infinite;
}

@keyframes iconPulse {
    0%, 100% { transform: scale(1); }
    50% { transform: scale(1.1); }
}

/* Эффект свечения для кнопок */
.glow-button {
    position: relative;
    overflow: hidden;
}

.glow-button::after {
    content: '';
    position: absolute;
    top: -50%;
    left: -50%;
    width: 200%;
    height: 200%;
    background: radial-gradient(circle at center, rgba(139, 92, 246, 0.4) 0%, transparent 70%);
    opacity: 0;
    transition: opacity 0.3s ease;
}

.glow-button:hover::after {
    opacity: 1;
}

/* Анимированные частицы фона */
.particles {
    position: absolute;
    inset: 0;
    pointer-events: none;
}

.particle {
    position: absolute;
    width: 3px;
    height: 3px;
    background: rgba(139, 92, 246, 0.5);
    border-radius: 50%;
    animation: particleFloat 15s infinite linear;
}

@keyframes particleFloat {
    0% {
        transform: translateY(0) rotate(0deg);
        opacity: 0;
    }
    50% {
        opacity: 0.8;
    }
    100% {
        transform: translateY(-100vh) rotate(360deg);
        opacity: 0;
    }
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Обработка загрузки аватара
    const avatarInput = document.getElementById('avatar-upload');
    if (avatarInput) {
        avatarInput.addEventListener('change', function() {
            if (this.files && this.files[0]) {
                const formData = new FormData();
                formData.append('avatar', this.files[0]);
                
                // Добавляем CSRF токен
                const csrftoken = document.querySelector('[name=csrfmiddlewaretoken]').value;
                
                fetch('{% url "blog:update_profile_avatar" %}', {
                    method: 'POST',
                    headers: {
                        'X-CSRFToken': csrftoken
                    },
                    body: formData
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        // Обновляем изображение аватара
                        const avatarImages = document.querySelectorAll('.avatar-container img');
                        avatarImages.forEach(img => {
                            img.src = data.avatar_url;
                        });
                        location.reload(); // Перезагружаем страницу
                    } else {
                        alert('Ошибка при загрузке аватара: ' + data.error);
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('Произошла ошибка при загрузке файла');
                });
            }
        });
    }

    // Обработка загрузки обложки
    const coverInput = document.getElementById('cover-upload');
    if (coverInput) {
        coverInput.addEventListener('change', function() {
            if (this.files && this.files[0]) {
                const formData = new FormData();
                formData.append('cover', this.files[0]);
                
                // Добавляем CSRF токен
                const csrftoken = document.querySelector('[name=csrfmiddlewaretoken]').value;
                
                fetch('{% url "blog:update_profile_cover" %}', {
                    method: 'POST',
                    headers: {
                        'X-CSRFToken': csrftoken
                    },
                    body: formData
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        // Обновляем изображение обложки
                        const coverImage = document.querySelector('.profile-cover img');
                        if (coverImage) {
                            coverImage.src = data.cover_url;
                        }
                        location.reload(); // Перезагружаем страницу
                    } else {
                        alert('Ошибка при загрузке обложки: ' + data.error);
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('Произошла ошибка при загрузке файла');
                });
            }
        });
    }
});
</script>
{% endblock %}